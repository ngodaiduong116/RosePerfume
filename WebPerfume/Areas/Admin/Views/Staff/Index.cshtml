@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<h2>Thống Kê Báo Cáo</h2>
<div class="row">
    <div class="col-sm-3">
        <div class="row">
            <div class="col-sm-9">
                <div id="dtDate"></div>
                @(Html.DevExtreme().DateBox().Width("100%").Value(new DateTime(DateTime.Now.Year, DateTime.Now.Month, 1)).Name("dxDateFrom").DisplayFormat("dd/MM/yyyy").Max(DateTime.Now.AddDays(-1)).ID("dtDateFrom"))
                @(Html.DevExtreme().DateBox().Width("100%").Value(DateTime.Now).Name("dxDateTo").DisplayFormat("dd/MM/yyyy").Max(DateTime.Now).ID("dtDateTo"))
            </div>
        </div>
    </div>
    <div class="col-sm-3">
        @(Html.DevExtreme().Button().Text("Search").Type(ButtonType.Default).OnClick("fnOnClick"))
    </div>
</div>
<div class="row dx-viewport">
    <div class="table-responsive col-md-12 " style="overflow-y:auto">
        @(Html.DevExtreme().DataGrid<WebPerfume.Areas.Admin.Model.CartModel>().DataSource(x=>x.Mvc().Area("admin").Controller("staff").LoadAction("ajaxStaff").OnBeforeSend("OnBeforeSend").Key("Id"))
                .ID("dxthongke")                
                .ShowBorders(true).ShowRowLines(true).FilterRow(x=>x.Visible(true)).RemoteOperations(true).HeaderFilter(x=>x.Visible(true))
                .Pager(x=>x.Visible(true).ShowInfo(true).AllowedPageSizes(new int[]{ 20,50,100 }).ShowPageSizeSelector(true)).ShowColumnLines(true)
                .Export(e => e.Enabled(true))
                .OnExporting("exporting")
                .Columns(col=> {
                    col.AddFor(x => x.ShipName);
                    col.AddFor(x => x.ShipMobile);
                    col.AddFor(x => x.ShipEmail);
                    col.AddFor(x => x.ShipAddress);
                    col.AddFor(x => x.ShipSuccess);
                    col.AddFor(x => x.Status).CellTemplate(new JS("CellTemplate"));
                    col.AddFor(x => x.CreateDate).CalculateCellValue("FromJsonToDate");
                }))
    </div>
</div>

@section scripts{
    <script>

        function FromJsonToDate(value) {
            if (value != null) {
                return new Date(parseInt(value.CreateDate.replace('/Date(', '')));
            }
            return;
        }
        function OnBeforeSend(method, settings) {
            settings.data.dateFrom = $('input[name="dxDateFrom"]').val();
            settings.data.dateTo = $('input[name="dxDateTo"]').val();
        }       

        function fnOnClick() {
            $("#dxthongke").dxDataGrid("instance").refresh();
        }
        function CellTemplate(container, options) {
            var div = '';
            console.log(options.value)
            switch (options.value) {
                case 2:
                    div = `<i class="fas fa-check-circle" style="color: #4caf50;"></i>`;
                    break;
                case 3:
                    div = `<i class="fas fa-check-circle" style="color: #d50000;"></i>`;
                    break;
                case 4:
                    div = `<i class="fas fa-check-circle" style="color: #df8d13;"></i>`;
                    break;
                default:
                    div = `<i class="fas fa-check-circle" style="color: #778dcd;"></i>`;
            }
            $(div).appendTo(container);
        }
        function exporting(e) {
            var workbook = new ExcelJS.Workbook();
            var worksheet = workbook.addWorksheet('Data');

            DevExpress.excelExporter.exportDataGrid({
                component: e.component,
                worksheet: worksheet,
                autoFilterEnabled: true,
            }).then(function () {
                workbook.xlsx.writeBuffer().then(function (buffer) {
                    saveAs(new Blob([buffer], { type: 'application/octet-stream' }), 'Data.xlsx');
                });
            });
            e.cancel = true;
        }
    </script>
}